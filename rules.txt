# Project Context
You are building a B2B Rental Management MVP for high-value items (Fine Jewelry).
The goal is a "Single-man MVP": prioritize simplicity, stability, and maintainability.
**Critical Constraint:** Inventory availability must be strictly accurate. We use Postgres Exclusion Constraints, not just application logic.

# Tech Stack
- **Framework:** Next.js 14+ (App Router).
- **Language:** TypeScript (Strict).
- **Database & Auth:** Supabase (Postgres).
- **Styling:** Tailwind CSS + Shadcn UI.
- **State/Forms:** React Hook Form + Zod.

# Coding Guidelines

## 1. Next.js App Router & Server Actions
- **Route Handlers:** Use `app/api/.../route.ts` for public webhooks or specific REST needs, but prefer **Server Actions** for form mutations.
- **Async Cookies:** When using cookies in Server Components/Actions, always treat them as async (await `cookies()`) to ensure compatibility with Next.js 15+.
- **Client/Server Boundary:** Keep logic on the server (`"use server"`). Only use `"use client"` for interactivity (forms, dialogs).

## 2. Supabase Integration (Strict)
- **Library:** Use `@supabase/ssr`. DO NOT use the deprecated `@supabase/auth-helpers-nextjs`.
- **Client Creation:**
  - **Server:** Use `createServerClient` with cookie handling.
  - **Browser:** Use `createBrowserClient`.
- **RLS & Security:**
  - RLS is the primary security layer. Application logic should not re-implement access control manually if RLS can handle it.
  - For performance, prefer `(select auth.uid())` or wrapper functions (e.g., `is_admin()`) in RLS policies to reduce overhead.

## 3. Database & Data Model
- **Dates:** All timestamps must be `timestamptz` (UTC).
- **Intervals:** Rental periods are **Half-open intervals `[start, end)`** (start is inclusive, end is exclusive).
- **Consistency:** Use Postgres **Exclusion Constraints (`gist`)** to prevent overlapping reservations at the DB level.
- **Type Safety:** Always generate and use `database.types.ts`.

## 4. UI/UX
- **Responsive:** The UI must be responsive (functional on mobile), but optimized for Desktop usage.
- **Feedback:** Use `sonner` or `toast` for user feedback.
- **Loading:** Use `Suspense` boundaries and Skeleton loaders.

# "Single-man MVP" Mindset
- **No Over-engineering:** Do not suggest Microservices, complex state management (Redux), or Stripe integration.
- **Bank Transfer Only:** The flow is Invoice -> Bank Transfer -> Manual "Mark as Paid".
- **Focus:** If the code involves "Availability", triple-check the logic.